import psycopg2  # PostgreSQL-–º–µ–Ω –∂“±–º—ã—Å —ñ—Å—Ç–µ—É “Ø—à—ñ–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞
import csv       # CSV —Ñ–∞–π–ª–¥–∞—Ä—ã–º–µ–Ω –∂“±–º—ã—Å —ñ—Å—Ç–µ—É “Ø—à—ñ–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞

# PostgreSQL –¥–µ—Ä–µ–∫“õ–æ—Ä—ã–Ω–∞ “õ–æ—Å—ã–ª—É
conn = psycopg2.connect(
    dbname="BAzA",        # –î–µ—Ä–µ–∫“õ–æ—Ä–¥—ã“£ –∞—Ç–∞—É—ã
    user="postgres",      # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∞—Ç—ã
    password="12345678",  # “ö“±–ø–∏—è—Å”©–∑
    host="localhost",     # –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —Ö–æ—Å—Ç
    port="5432"           # PostgreSQL ”ô–¥–µ–ø–∫—ñ –ø–æ—Ä—Ç—ã
)
cur = conn.cursor()  # SQL —Å“±—Ä–∞–Ω—ã—Å—Ç–∞—Ä—ã–Ω –æ—Ä—ã–Ω–¥–∞—É “Ø—à—ñ–Ω –∫—É—Ä—Å–æ—Ä –∂–∞—Å–∞—É

# üìå 1. –ö–µ—Å—Ç–µ “õ“±—Ä—É
cur.execute("""
    CREATE TABLE IF NOT EXISTS phonebook (  -- –ï–≥–µ—Ä –∫–µ—Å—Ç–µ –∂–æ“õ –±–æ–ª—Å–∞, –æ—Å—ã–Ω—ã –∂–∞—Å–∞–π–¥—ã
        id SERIAL PRIMARY KEY,              -- –ë—ñ—Ä–µ–≥–µ–π –∞–≤—Ç–æ–º–∞—Ç—Ç—ã ID (–±–∞—Å—Ç—ã –∫—ñ–ª—Ç)
        name VARCHAR(50),                   -- –ê–¥–∞–º–Ω—ã“£ –∞—Ç—ã (50 —Ç–∞“£–±–∞“ì–∞ –¥–µ–π—ñ–Ω)
        phone VARCHAR(20)                   -- –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ (20 —Ç–∞“£–±–∞“ì–∞ –¥–µ–π—ñ–Ω)
    );
""")
conn.commit()  # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –¥–µ—Ä–µ–∫“õ–æ—Ä–¥–∞ —Å–∞“õ—Ç–∞—É

# üìå 2. CSV —Ñ–∞–π–ª–¥–∞–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –∂“Ø–∫—Ç–µ—É
def load_from_csv():
    with open('psycopg2.csv', 'r') as f:          # CSV —Ñ–∞–π–ª—ã–Ω –æ“õ—É “Ø—à—ñ–Ω –∞—à—É
        reader = csv.reader(f)                    # CSV –æ“õ—É –æ–±—ä–µ–∫—Ç—ñ—Å—ñ
        next(reader)                              # –ë—ñ—Ä—ñ–Ω—à—ñ –∂–æ–ª–¥—ã (—Ç–∞“õ—ã—Ä—ã–ø) ”©—Ç–∫—ñ–∑—ñ–ø –∂—ñ–±–µ—Ä—É
        for row in reader:                        # ”ò—Ä –∂–æ–ª–¥—ã –æ“õ—É
            if len(row) >= 2:                     # –ï–≥–µ—Ä –∞—Ç—ã –º–µ–Ω –Ω–æ–º–µ—Ä—ñ –±–∞—Ä –±–æ–ª—Å–∞
                cur.execute(
                    "INSERT INTO phonebook (name, phone) VALUES (%s, %s)",
                    (row[0], row[1])              # –ê—Ç—ã–Ω –∂”ô–Ω–µ –Ω–æ–º–µ—Ä—ñ–Ω –µ–Ω–≥—ñ–∑—É
                )
    conn.commit()                                 # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Å–∞“õ—Ç–∞—É
    print("CSV –∂“Ø–∫—Ç–µ–ª–¥—ñ!")                        # –•–∞–±–∞—Ä–ª–∞–º–∞ —à—ã“ì–∞—Ä—É

# üìå 3. “ö–æ–ª–º–µ–Ω –¥–µ—Ä–µ–∫ –µ–Ω–≥—ñ–∑—É
def insert_manually():
    name = input("–ê—Ç—ã“£: ")                        # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–¥–∞–Ω –∞—Ç—ã —Å“±—Ä–∞–ª–∞–¥—ã
    phone = input("–ù”©–º—ñ—Ä—ñ“£: ")                    # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–¥–∞–Ω –Ω–æ–º–µ—Ä —Å“±—Ä–∞–ª–∞–¥—ã
    cur.execute(
        "INSERT INTO phonebook (name, phone) VALUES (%s, %s)",
        (name, phone)                             # –î–µ—Ä–µ–∫“õ–æ—Ä“ì–∞ –µ–Ω–≥—ñ–∑—É
    )
    conn.commit()                                 # ”®–∑–≥–µ—Ä—ñ—Å—Ç—ñ —Å–∞“õ—Ç–∞—É
    print("–î–µ—Ä–µ–∫ “õ–æ—Å—ã–ª–¥—ã!")                       # –•–∞–±–∞—Ä–ª–∞–º–∞

# üìå 4. –î–µ—Ä–µ–∫—Ç—ñ –∂–∞“£–∞—Ä—Ç—É
def update_entry():
    name = input("“ö–∞–π –∞—Ç—Ç—ã ”©–∑–≥–µ—Ä—Ç–µ–º—ñ–∑? ")         # “ö–∞–π –∞–¥–∞–º–Ω—ã“£ –Ω–æ–º–µ—Ä—ñ–Ω ”©–∑–≥–µ—Ä—Ç–µ—Ç—ñ–Ω—ñ–º—ñ–∑–¥—ñ —Å“±—Ä–∞—É
    new_phone = input("–ñ–∞“£–∞ –Ω–æ–º–µ—Ä: ")             # –ñ–∞“£–∞ –Ω–æ–º–µ—Ä–¥—ñ –µ–Ω–≥—ñ–∑—É
    cur.execute(
        "UPDATE phonebook SET phone = %s WHERE name = %s",
        (new_phone, name)                         # –ö”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω –∞–¥–∞–º“ì–∞ –∂–∞“£–∞ –Ω–æ–º–µ—Ä –±–µ—Ä—É
    )
    conn.commit()                                 # ”®–∑–≥–µ—Ä—ñ—Å—Ç—ñ —Å–∞“õ—Ç–∞—É
    print("–ñ–∞“£–∞—Ä—Ç—ã–ª–¥—ã!")                          # –•–∞–±–∞—Ä–ª–∞–º–∞

# üìå 5. –ê–¥–∞–º–¥—ã –∞—Ç—ã –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É
def query_data():
    filter_name = input("–ê—Ç—ã –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É: ")    # –Ü–∑–¥–µ—É “Ø—à—ñ–Ω –∞—Ç—ã –µ–Ω–≥—ñ–∑—ñ–ª–µ–¥—ñ
    cur.execute(
        "SELECT * FROM phonebook WHERE name ILIKE %s",
        ('%' + filter_name + '%',)                # –ÜLIKE ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–≥–µ —Ç”ô—É–µ–ª—Å—ñ–∑ —ñ–∑–¥–µ—É
    )
    results = cur.fetchall()                      # –ë–∞—Ä–ª—ã“õ —Ç–∞–±—ã–ª“ì–∞–Ω –∂–æ–ª–¥–∞—Ä–¥—ã –∞–ª—É
    for row in results:
        print(row)                                # ”ò—Ä —Ç–∞–±—ã–ª“ì–∞–Ω –∂–æ–ª–¥—ã –±–∞—Å—ã–ø —à—ã“ì–∞—Ä—É

# üìå 6. –ê–¥–∞–º–¥—ã ”©—à—ñ—Ä—É
def delete_entry():
    name = input("–ö—ñ–º–¥—ñ ”©—à—ñ—Ä–µ—Å—ñ–∑ (–∞—Ç—ã): ")        # ”®—à—ñ—Ä—É “Ø—à—ñ–Ω –∞—Ç—ã –µ–Ω–≥—ñ–∑—ñ–ª–µ–¥—ñ
    cur.execute(
        "DELETE FROM phonebook WHERE name = %s",
        (name,)                                   # –ö”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω –∞—Ç—Ç—ã ”©—à—ñ—Ä—É
    )
    conn.commit()                                 # ”®–∑–≥–µ—Ä—ñ—Å—Ç—ñ —Å–∞“õ—Ç–∞—É
    print("”®—à—ñ—Ä—ñ–ª–¥—ñ!")                            # –•–∞–±–∞—Ä–ª–∞–º–∞

# üìå 7. –ù–µ–≥—ñ–∑–≥—ñ –º”ô–∑—ñ—Ä: “õ–∞–π —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã —Ç–∞“£–¥–∞–π—Ç—ã–Ω—ã–Ω —Å“±—Ä–∞–π–º—ã–∑
while True:
    print("\n===== PHONEBOOK –ú”ò–ó–Ü–†–Ü =====")
    print("1. CSV-—Ç–µ–Ω –∂“Ø–∫—Ç–µ—É")
    print("2. “ö–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É")
    print("3. –ñ–∞“£–∞—Ä—Ç—É")
    print("4. –Ü–∑–¥–µ—É")
    print("5. ”®—à—ñ—Ä—É")
    print("0. –®—ã“ì—É")

    choice = input("–¢–∞“£–¥–∞: ")                     # –¢–∞“£–¥–∞—É –µ–Ω–≥—ñ–∑—É
    if choice == "1":
        load_from_csv()                           # 1 ‚Üí CSV –∂“Ø–∫—Ç–µ—É
    elif choice == "2":
        insert_manually()                         # 2 ‚Üí “õ–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É
    elif choice == "3":
        update_entry()                            # 3 ‚Üí –¥–µ—Ä–µ–∫ –∂–∞“£–∞—Ä—Ç—É
    elif choice == "4":
        query_data()                              # 4 ‚Üí —ñ–∑–¥–µ—É
    elif choice == "5":
        delete_entry()                            # 5 ‚Üí ”©—à—ñ—Ä—É
    elif choice == "0":
        break                                     # 0 ‚Üí –±–∞“ì–¥–∞—Ä–ª–∞–º–∞–¥–∞–Ω —à—ã“ì—É
    else:
        print("“ö–∞—Ç–µ —Ç–∞“£–¥–∞—É!")                     # –ë–∞—Å“õ–∞ —Ç–∞“£–¥–∞—É –±–æ–ª—Å–∞ ‚Äî “õ–∞—Ç–µ

# üìå 8. –ë–∞“ì–¥–∞—Ä–ª–∞–º–∞ —Å–æ“£—ã–Ω–¥–∞ ‚Äî –±”ô—Ä—ñ–Ω –∂–∞–±—É
cur.close()                                       # –ö—É—Ä—Å–æ—Ä–¥—ã –∂–∞–±—É
conn.close()                                      # –î–µ—Ä–µ–∫“õ–æ—Ä –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω –∂–∞–±—É
